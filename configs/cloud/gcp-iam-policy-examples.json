{
  "Description": "Sample GCP IAM Policies for Common Use Cases",
  "Policies": [
    {
      "Name": "ComputeEngineReadOnly",
      "Description": "Read-only access to Compute Engine instances",
      "Role": "roles/compute.viewer",
      "CustomPolicy": {
        "title": "Compute Engine Read Only",
        "description": "Read-only access to Compute Engine resources",
        "stage": "GA",
        "includedPermissions": [
          "compute.instances.get",
          "compute.instances.list",
          "compute.disks.get",
          "compute.disks.list",
          "compute.networks.get",
          "compute.networks.list",
          "compute.firewalls.get",
          "compute.firewalls.list"
        ]
      }
    },
    {
      "Name": "CloudStorageBucketAccess",
      "Description": "Full access to specific Cloud Storage bucket",
      "CustomPolicy": {
        "title": "Storage Bucket Access",
        "description": "Full access to specific storage bucket",
        "stage": "GA",
        "includedPermissions": [
          "storage.buckets.get",
          "storage.buckets.list",
          "storage.objects.get",
          "storage.objects.list",
          "storage.objects.create",
          "storage.objects.delete",
          "storage.objects.update"
        ]
      },
      "Binding": {
        "role": "roles/storage.objectAdmin",
        "members": [
          "user:developer@example.com",
          "serviceAccount:app-service@project-id.iam.gserviceaccount.com"
        ],
        "condition": {
          "title": "Specific bucket only",
          "description": "Access limited to my-app-bucket",
          "expression": "resource.name.startsWith('projects/_/buckets/my-app-bucket')"
        }
      }
    },
    {
      "Name": "CloudLoggingAccess",
      "Description": "Write access to Cloud Logging",
      "Role": "roles/logging.logWriter",
      "CustomPolicy": {
        "title": "Log Writer",
        "description": "Write logs to Cloud Logging",
        "stage": "GA",
        "includedPermissions": [
          "logging.logEntries.create",
          "logging.logs.list"
        ]
      }
    },
    {
      "Name": "ComputeEngineInstanceRole",
      "Description": "Service account for Compute Engine instances to access Storage and Logging",
      "ServiceAccount": "vm-service-account@project-id.iam.gserviceaccount.com",
      "Roles": [
        "roles/storage.objectViewer",
        "roles/logging.logWriter",
        "roles/monitoring.metricWriter"
      ]
    },
    {
      "Name": "CloudSQLReadAccess",
      "Description": "Read-only access to Cloud SQL instances",
      "Role": "roles/cloudsql.viewer",
      "CustomPolicy": {
        "title": "Cloud SQL Read Access",
        "description": "View Cloud SQL instances and databases",
        "stage": "GA",
        "includedPermissions": [
          "cloudsql.instances.get",
          "cloudsql.instances.list",
          "cloudsql.databases.get",
          "cloudsql.databases.list"
        ]
      }
    },
    {
      "Name": "BackupOperatorRole",
      "Description": "Role for automated backup operations",
      "CustomPolicy": {
        "title": "Backup Operator",
        "description": "Create and manage backups",
        "stage": "GA",
        "includedPermissions": [
          "compute.disks.createSnapshot",
          "compute.snapshots.create",
          "compute.snapshots.delete",
          "compute.snapshots.get",
          "compute.snapshots.list",
          "storage.objects.create",
          "storage.objects.get",
          "storage.objects.delete"
        ]
      }
    },
    {
      "Name": "DeveloperAccess",
      "Description": "Limited access for developers (no production modifications)",
      "CustomPolicy": {
        "title": "Developer Access",
        "description": "Read access with limited control over dev resources",
        "stage": "GA",
        "includedPermissions": [
          "compute.instances.get",
          "compute.instances.list",
          "compute.instances.start",
          "compute.instances.stop",
          "storage.buckets.get",
          "storage.buckets.list",
          "storage.objects.get",
          "storage.objects.list",
          "cloudsql.instances.get",
          "cloudsql.instances.list",
          "logging.logEntries.list",
          "logging.logs.list",
          "monitoring.timeSeries.list"
        ]
      },
      "Binding": {
        "role": "projects/project-id/roles/developerAccess",
        "members": [
          "user:developer@example.com"
        ],
        "condition": {
          "title": "Development environment only",
          "description": "Access limited to resources with environment=development label",
          "expression": "resource.matchLabels('environment', 'development')"
        }
      }
    },
    {
      "Name": "CloudFunctionExecutionRole",
      "Description": "Execution role for Cloud Functions",
      "ServiceAccount": "function-sa@project-id.iam.gserviceaccount.com",
      "Roles": [
        "roles/cloudfunctions.invoker",
        "roles/logging.logWriter",
        "roles/storage.objectViewer"
      ]
    },
    {
      "Name": "MonitoringAndLoggingRole",
      "Description": "Full access to monitoring and logging",
      "Roles": [
        "roles/monitoring.metricWriter",
        "roles/logging.logWriter",
        "roles/logging.viewer"
      ]
    },
    {
      "Name": "NetworkAdminRole",
      "Description": "Manage VPC networks and firewall rules",
      "Role": "roles/compute.networkAdmin",
      "CustomPolicy": {
        "title": "Network Administrator",
        "description": "Manage network resources",
        "stage": "GA",
        "includedPermissions": [
          "compute.networks.*",
          "compute.subnetworks.*",
          "compute.firewalls.*",
          "compute.routes.*",
          "compute.routers.*"
        ]
      }
    }
  ],
  "ServiceAccountExamples": [
    {
      "Name": "vm-service-account",
      "DisplayName": "VM Service Account",
      "Description": "Service account for Compute Engine VMs",
      "Email": "vm-service-account@project-id.iam.gserviceaccount.com",
      "Roles": [
        "roles/storage.objectViewer",
        "roles/logging.logWriter",
        "roles/monitoring.metricWriter"
      ]
    },
    {
      "Name": "backup-service-account",
      "DisplayName": "Backup Service Account",
      "Description": "Service account for automated backups",
      "Email": "backup-sa@project-id.iam.gserviceaccount.com",
      "Roles": [
        "roles/compute.storageAdmin",
        "roles/storage.admin"
      ]
    },
    {
      "Name": "app-service-account",
      "DisplayName": "Application Service Account",
      "Description": "Service account for application workloads",
      "Email": "app-sa@project-id.iam.gserviceaccount.com",
      "Roles": [
        "roles/cloudsql.client",
        "roles/storage.objectAdmin",
        "roles/logging.logWriter"
      ]
    }
  ],
  "UsageInstructions": [
    "1. Create service account: gcloud iam service-accounts create SERVICE_ACCOUNT_NAME --display-name='Display Name'",
    "2. Grant role to service account: gcloud projects add-iam-policy-binding PROJECT_ID --member='serviceAccount:SERVICE_ACCOUNT_EMAIL' --role='ROLE_NAME'",
    "3. Grant role to user: gcloud projects add-iam-policy-binding PROJECT_ID --member='user:USER_EMAIL' --role='ROLE_NAME'",
    "4. Create custom role: gcloud iam roles create ROLE_NAME --project=PROJECT_ID --file=role-definition.yaml",
    "5. List IAM policies: gcloud projects get-iam-policy PROJECT_ID",
    "6. List service accounts: gcloud iam service-accounts list",
    "7. Create service account key: gcloud iam service-accounts keys create key.json --iam-account=SERVICE_ACCOUNT_EMAIL",
    "8. Attach service account to VM: gcloud compute instances create INSTANCE_NAME --service-account=SERVICE_ACCOUNT_EMAIL --scopes=cloud-platform"
  ],
  "CustomRoleYAMLExample": {
    "title": "Custom Developer Role",
    "description": "Custom role for developers with limited permissions",
    "stage": "GA",
    "includedPermissions": [
      "compute.instances.get",
      "compute.instances.list",
      "compute.instances.start",
      "compute.instances.stop",
      "storage.objects.get",
      "storage.objects.list",
      "logging.logEntries.list"
    ]
  },
  "PolicyBindingExample": {
    "bindings": [
      {
        "role": "roles/compute.admin",
        "members": [
          "user:admin@example.com"
        ]
      },
      {
        "role": "roles/storage.objectViewer",
        "members": [
          "serviceAccount:vm-service@project-id.iam.gserviceaccount.com",
          "user:developer@example.com"
        ],
        "condition": {
          "title": "Expires in 2026",
          "description": "Access expires at end of 2026",
          "expression": "request.time < timestamp('2026-12-31T23:59:59Z')"
        }
      }
    ],
    "etag": "BwXYZ123456=",
    "version": 3
  },
  "ConditionalAccessExamples": [
    {
      "Name": "TimeBasedAccess",
      "Description": "Grant access only during business hours",
      "Condition": {
        "title": "Business hours only",
        "description": "Access allowed Monday-Friday 9am-5pm",
        "expression": "request.time.getHours('America/New_York') >= 9 && request.time.getHours('America/New_York') <= 17 && request.time.getDayOfWeek('America/New_York') >= 1 && request.time.getDayOfWeek('America/New_York') <= 5"
      }
    },
    {
      "Name": "ResourceLabelBasedAccess",
      "Description": "Grant access only to resources with specific labels",
      "Condition": {
        "title": "Environment specific access",
        "description": "Access only development environment resources",
        "expression": "resource.matchLabels('environment', 'development')"
      }
    },
    {
      "Name": "TemporaryAccess",
      "Description": "Grant temporary access with expiration",
      "Condition": {
        "title": "Temporary access",
        "description": "Access valid until specific date",
        "expression": "request.time < timestamp('2026-06-30T23:59:59Z')"
      }
    }
  ],
  "BestPractices": [
    "Use least privilege principle - grant only necessary permissions",
    "Use predefined roles when possible instead of primitive roles (Owner, Editor, Viewer)",
    "Create custom roles for specific use cases",
    "Use service accounts for applications and VMs",
    "Regularly audit IAM policies with gcloud projects get-iam-policy",
    "Enable Cloud Audit Logging for all IAM changes",
    "Use conditional access for time-bound or resource-specific permissions",
    "Rotate service account keys regularly",
    "Use Workload Identity for GKE workloads instead of service account keys",
    "Apply resource labels for better access control and organization",
    "Use IAM conditions to restrict access based on resource attributes",
    "Enable multi-factor authentication (MFA) for user accounts",
    "Review and remove unused service accounts and keys",
    "Use organization policies to enforce security controls"
  ],
  "CommonPredefinedRoles": {
    "Compute": [
      "roles/compute.admin - Full control of Compute Engine resources",
      "roles/compute.viewer - Read-only access to Compute Engine resources",
      "roles/compute.instanceAdmin.v1 - Full control of Compute Engine instances",
      "roles/compute.networkAdmin - Full control of networking resources",
      "roles/compute.securityAdmin - Full control of firewall rules and SSL certificates"
    ],
    "Storage": [
      "roles/storage.admin - Full control of Cloud Storage resources",
      "roles/storage.objectAdmin - Full control of objects",
      "roles/storage.objectViewer - Read access to objects",
      "roles/storage.objectCreator - Write access to objects"
    ],
    "CloudSQL": [
      "roles/cloudsql.admin - Full control of Cloud SQL resources",
      "roles/cloudsql.client - Connect to Cloud SQL instances",
      "roles/cloudsql.editor - Edit Cloud SQL resources",
      "roles/cloudsql.viewer - View Cloud SQL resources"
    ],
    "Logging": [
      "roles/logging.admin - Full control of Cloud Logging",
      "roles/logging.logWriter - Write log entries",
      "roles/logging.viewer - View log entries",
      "roles/logging.privateLogViewer - View all log entries including private logs"
    ],
    "Monitoring": [
      "roles/monitoring.admin - Full control of Cloud Monitoring",
      "roles/monitoring.metricWriter - Write monitoring metrics",
      "roles/monitoring.viewer - View monitoring data"
    ]
  }
}
